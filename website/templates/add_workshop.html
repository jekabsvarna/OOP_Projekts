{% extends "base.html" %}
{% block content %}

<div class="container">
  <form action="{{ url_for('views.add_workshop') }}" method="post" id="workshop-form">
    <input type="text" name="title" placeholder="Workshop Title" required>
    <input type="datetime-local" name="date" required>

    <div class="student-selection-wrapper" style="margin-top: 50px;"> <div class="col-md-6 pr-0 student-list-container">
        <h3>No group</h3>
        <table class="table student-table table-bordered">
          <thead>
            <tr>
              <th>Name</th>
            </tr>
          </thead>
          <tbody class="all-students-list">
            {% for student in students %}
              <tr data-id="{{ student.id }}">
                <td>{{ student.first_name }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="col-md-6 pl-0 student-list-container">
        <h3>Group A</h3>
        <table class="table student-table table-bordered">
          <thead>
            <tr>
              <th>Name</th>
            </tr>
          </thead>
          <tbody class="selected-students-list">
            </tbody>
        </table>
      </div>
    </div>

    <input type="hidden" id="selected-students" name="students">

    <button type="submit">Create Workshop</button>
  </form>
</div>

<style>
    .container {
      display: flex;
      justify-content: center;
    }
  
    .student-selection-wrapper {
      display: flex;
      margin: 10px auto;
    }
  
    .student-list-container {
      border: 5px solid #ccc; /* Changed border color to grey */
      border-radius: 4px;
      margin: 0 10px;
      width: calc(200px); /* Adjusted width to 55% */
    }
  
    .student-table {
      width: 100%;
      margin-bottom: 0;
      border: 5px solid #ccc; /* Changed border color to grey */
    }
  
    /* Hide student row on selection */
    .all-students-list tr[data-selected="true"] {
      display: none;
    }
  </style>
  
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var workshopForm = document.getElementById('workshop-form');
      var allStudents = workshopForm.querySelector('.all-students-list');
      var selectedStudentsList = workshopForm.querySelector('.selected-students-list');
      var selectedStudentsInput = workshopForm.querySelector('#selected-students');
  
      // Function to add a student to the selected list
      function addStudent(studentId, studentName) {
        var newRow = document.createElement('tr');
        newRow.innerHTML = '<td>' + studentName + '</td>';
        newRow.dataset.id = studentId; // Set data-id attribute
        selectedStudentsList.appendChild(newRow);
        // Add student ID to the list
        addStudentId(studentId);
      }
  
      // Function to remove a student from the selected list
      function removeStudent(studentId) {
        var selectedRow = selectedStudentsList.querySelector('tr[data-id="' + studentId + '"]');
        if (selectedRow) {
          selectedRow.remove();
          // Remove student ID from the list
          removeStudentId(studentId);
        }
      }
  
      // Function to add a student ID to the selected students input field
      function addStudentId(studentId) {
        var currentIds = selectedStudentsInput.value ? JSON.parse(selectedStudentsInput.value) : [];
        currentIds.push(studentId);
        selectedStudentsInput.value = JSON.stringify(currentIds);
      }
  
      // Function to remove a student ID from the selected students input field
      function removeStudentId(studentId) {
        var currentIds = selectedStudentsInput.value ? JSON.parse(selectedStudentsInput.value) : [];
        var index = currentIds.indexOf(studentId);
        if (index !== -1) {
          currentIds.splice(index, 1);
          selectedStudentsInput.value = JSON.stringify(currentIds);
        }
      }
  
      // Event listener to move a student back to the first list when clicked
      selectedStudentsList.addEventListener('click', function (event) {
        if (event.target.tagName === 'TD') {
          var studentId = event.target.parentElement.dataset.id;
          var studentName = event.target.textContent;
  
          // Remove student from the selected list
          removeStudent(studentId);
  
          // Mark student row as unselected for showing in the first list
          var unselectedRow = allStudents.querySelector('tr[data-id="' + studentId + '"]');
          if (unselectedRow) {
            unselectedRow.dataset.selected = "false";
          }
        }
      });
  
      // Event listener to add a student to the selected list when clicked
      allStudents.addEventListener('click', function (event) {
        if (event.target.tagName === 'TD') {
          var studentId = event.target.parentElement.dataset.id;
          var studentName = event.target.textContent;
  
          var existingStudent = selectedStudentsList.querySelector('td:first-child');
          if (!existingStudent || existingStudent.textContent !== studentName) {
            // Add student to the selected list
            addStudent(studentId, studentName);
  
            // Mark student row as selected for hiding
            event.target.parentElement.dataset.selected = "true";
          }
        }
      });
  
      // Form submission validation
      workshopForm.addEventListener('submit', function (event) {
        if (selectedStudentsList.children.length === 0) {
          event.preventDefault();
          alert('Please select at least one student.');
        }
      });
    });
  </script>
  
{% endblock %}
